# [Azure Sentinel Hackathon 2021](https://github.com/MSSAPSCA1/Azure_Sentinel)
**Azure Resource Manager (ARM) Templates for Bulk Activation of Azure Sentinel Analytics Rules.**
___
## [ARM Templates for Default Analytics Rules](https://github.com/MSSAPSCA1/Azure_Sentinel/tree/main/Default_AZ_Sentinel_Rule_Templates)

ARM templates for specific sets of default Azure Sentinel Analytics Rules.
* Rule Frequency = Default
* Rule Period = Default

### Analytics Rules:
*  [(Preview) TI map...](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/(Preview)_TI_map_AZ_Sentinel_Analytics_Rules.json)
*  [Account added and removed from privileged groups](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Account_added_and_removed_from_privileged_groups__AZ_Sentinel_Analytics_Rule.json)
*  [Active Directory](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Active_Directory_AZ_Sentinel_Analytics_Rules.json)
*  [Anomalous login followed by Teams action](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Anomalous_AZ_Sentinel_Analytics_Rules.json)
*  [Anomalous sign-in location by user account and authenticating application](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Anomalous_AZ_Sentinel_Analytics_Rules.json)
*  [Anomalous User Agent connection attempt](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Anomalous_AZ_Sentinel_Analytics_Rules.json)
*  [AppServices AV Scan](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/AppServices_AV_Scan_AZ_Sentinel_Analytics_Rules.json)
*  [Attempt to bypass conditional access rule in Azure AD](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Attempt..._AZ_Sentinel_Analytics_Rules.json)
*  [Attempts to sign in to disabled accounts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Attempt..._AZ_Sentinel_Analytics_Rules.json)
*  [Audit policy manipulation using auditpol utility](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Audit_policy_manipulation_using_auditpol_utility_AZ_Sentinel_Analytics_Rule.json)
*  [Azure Active Directory PowerShell accessing non-AAD resource](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Azure_Active_Directory_PowerShell_accessing_non-AAD_resource_AZ_Sentinel_Analytics_Rule.json)
*  [Azure DevOps](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Azure_DevOps_AZ_Sentinel_Analytics_Rules.json)
*  [Azure Key Vault access TimeSeries anomaly](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Azure_Key_Vault_access_TimeSeries_anomaly_AZ_Sentinel_Analytics_Rule.json)
*  [Base64 encoded Windows process command-lines](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Base64_encoded_Windows_process_command-lines_AZ_Sentinel_Analytics_Rule.json)
*  [Brute force attack against...](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Brute_force_attack_against..._AZ_Sentinel_Analytics_Rules.json)
*  [Changes made to AWS CloudTrail logs](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Changes..._AZ_Sentinel_Analytics_Rules.json)
*  [Changes to Amazon VPC settings](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Changes..._AZ_Sentinel_Analytics_Rules.json)
*  [Changes to AWS Elastic Load Balancer security groups](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Changes..._AZ_Sentinel_Analytics_Rules.json)
*  [Changes to AWS Security Group ingress and egress settings](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Changes..._AZ_Sentinel_Analytics_Rules.json)
*  [Changes to internet facing AWS RDS Database instances](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Changes..._AZ_Sentinel_Analytics_Rules.json)
*  [Cisco...](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Cisco..._AZ_Sentinel_Analytics_Rules.json)
*  [Correlate Unfamiliar sign-in properties and atypical travel alerts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Correlate_Unfamiliar_sign-in_properties_and_atypical_travel_alerts_AZ_Sentinel_Analytics_Rule.json)
*  [Create incidents based on Azure Active Directory Identity Protection alerts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Create_incidents_based_on..._AZ_Sentinel_Analytics_Rules.json)
*  [Create incidents based on Azure Defender alerts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Create_incidents_based_on..._AZ_Sentinel_Analytics_Rules.json)
*  [Create incidents based on Azure Defender for IOT alerts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Create_incidents_based_on..._AZ_Sentinel_Analytics_Rules.json)
*  [Create incidents based on Microsoft Cloud App Security alerts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Create_incidents_based_on..._AZ_Sentinel_Analytics_Rules.json)
*  [Create incidents based on Microsoft Defender for Endpoint alerts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Create_incidents_based_on..._AZ_Sentinel_Analytics_Rules.json)
*  [Create incidents based on Microsoft Defender for Identity alerts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Create_incidents_based_on..._AZ_Sentinel_Analytics_Rules.json)
*  [Create incidents based on Microsoft Defender for Office 365 alerts](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Create_incidents_based_on..._AZ_Sentinel_Analytics_Rules.json)
*  [Creation of expensive computes in Azure](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Creation_of_expensive_computes_in_Azure_AZ_Sentinel_Analytics_Rule.json)
*  [Credential added after admin consented to Application](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Credential_added_after_admin_consented_to_Application_AZ_Sentinel_Analytics_Rule.json)
*  [DEV-0322 Serv-U related IOCs-July 2021](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/DEV-0322_Serv-U_related_IOCs-July%202021_AZ_Sentinel_Analytics_Rule.json)
*  [DNS events related to...](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/DNS_events_related_to_AZ_Sentinel_Analytics_Rules.json)
*  [Distributed Password cracking attempts in AzureAD](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Distributed_Password_cracking_attempts_in_AzureAD_AZ_Sentinel_Analytics_Rule.json)
*  [Email access via active sync](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Email_access_via_active_sync_AZ_Sentinel_Analytics_Rule.json)
*  [Excessive NXDOMAIN DNS Queries (Normalized DNS)](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Excessive..._AZ_Sentinel_Analytics_Rules.json)
*  [Excessive Windows logon failures](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Excessive..._AZ_Sentinel_Analytics_Rules.json)
*  [Exchange...](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Exchange..._AZ_Sentinel_Analytics_Rules.json)
*  [Explicit MFA Deny](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Explicit%20_MFA_Deny_AZ_Sentinel_Analytics_Rule.json)
*  [External Upstream Source Added to Azure DevOps Feed](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/External..._AZ_Sentinel_Analytics_Rules.json)
*  [External user added and removed in short timeframe](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/External..._AZ_Sentinel_Analytics_Rules.json)
*  [Failed...](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Failed..._AZ_Sentinel_Analytics_Rules.json)
*  [First access credential added to Application or Service Principal where no credential was present](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/First_access_credential_added_to_Application_or..._AZ_Sentinel_Analytics_Rule.json)
*  [Vectra Detection and AI Detection](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Default_AZ_Sentinel_Rule_Templates/Vectra_Detect_AZ_Sentinel_Analytics_Rules.json)
___
## [ARM Templates for Quick Response Analytics Rules](https://github.com/MSSAPSCA1/Azure_Sentinel/tree/main/Quick_Response_AZ_Sentinel_Rule_Templates)

Modified ARM templates for specific sets of high frequency Azure Sentinel Analytics Rules. 
* Rule Frequency = 10 minutes
* Rule Period = 30 minutes

### Analytics Rules:
* [Vectra Detection and AI Detection](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/Quick_Response_AZ_Sentinel_Rule_Templates/QR_Vectra_Detect_AZ_Sentinel_Analytics_Rules.json)
___
## [ARM Template Editor for Analytics Rules](https://github.com/MSSAPSCA1/Azure_Sentinel/blob/main/AZ_Sentinel_Analytics_Rules_Editor.py)

Python script to modify properties of Azure Resource Manager (ARM) templates for bulk modification of Azure Sentinel Analytics Rules. Currently capable of modifying Rule Status (Enabled/Disabled), Rule Frequency, and Rule Period for any number of Azure Sentinel Analytics Rules contained within any number of ARM template files.

### Notes from Azure Sentinel:
* The Rule Frequency (queryFrequency) value must be between 5 minutes and 14 days.
* The Rule Period (queryPeriod) value must be between 5 minutes and 14 days.
* The Rule Frequency must be less than, or equal to, the Rule Period.
* When the Rule Period is greater than, or equal to, 2 days, the Rule Frequency must be greater than, or equal to, 1 hour.

### Operating Instructions:

**Prerequisites:**
* Python 3 Interpreter. (see Microsoft Docs/ Microsoft Learn for [validation](https://docs.microsoft.com/en-us/learn/modules/python-install-vscode/2-python-programming-language?pivots=windows) or [install](https://docs.microsoft.com/en-us/learn/modules/python-install-vscode/3-exercise-install-python3?pivots=windows) instructions)
* Path to ARM template/ ARM template file address in directory.

**Procedure:**
1.  Open the AZ_Sentinel_Analytics_Rules_Editor.py using a Python 3 Interpreter.
2.  Enter the path to the ARM template file(s) (i.e. C:\fakepath\AZ_Sentinel\Vectra_Detect_AZ_Sentinel_Analytics_Rules.json), or drag-and-drop each file, one at a time. Separate each file using a comma (,).
3.  Select options by entering the number associated with the option.
4.  Enter requested data based on constraints specified in the program and in the Notes from Azure Sentinel.
5.  Once the process is completed, a new file or new files will be created at the same address as the original file(s) with the word "NEW" appended as the prefix of the filename(s). You will now have two files for each ARM template, the orignal and the new file.
___
